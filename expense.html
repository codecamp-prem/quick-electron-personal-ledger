<html lang="en">
    <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="/docs/4.0/assets/img/favicons/favicon.ico">
<link rel="stylesheet" href="./src/css/googleMaterialIcon.css">
<link rel="stylesheet" href="./src/css/font-awesome.min.css">
    <title>Dashboard - Destination Travels & Tours PVT. LTD</title>
    <link rel="canonical" href="#">
    <!-- Bootstrap core CSS -->
    <link href="./src/css/bootstrap.min.css" rel="stylesheet">
    <link href="./src/css/dataTables.bootstrap4.min.css" rel="stylesheet">
    
    <!-- Custom styles for this template -->
    <link href="./src/css/dashboard.css" rel="stylesheet">
    <style type="text/css">/* Chart.js */
    @-webkit-keyframes chartjs-render-animation{from{opacity:0.99}to{opacity:1}}@keyframes chartjs-render-animation{from{opacity:0.99}to{opacity:1}}.chartjs-render-monitor{-webkit-animation:chartjs-render-animation 0.001s;animation:chartjs-render-animation 0.001s;}</style>
    </head>

  <body>
    <nav class="navbar navbar-dark sticky-top bg-dark flex-md-nowrap p-0">
      <a class="navbar-brand col-sm-3 col-md-2 mr-0" href="#">Destination Travels & Tours</a>
      
      <ul class="navbar-nav px-3">
        <li class="nav-item text-nowrap">
          <a class="nav-link" href="#">Sign out</a>
        </li>
      </ul>
    </nav>

    <div class="container-fluid">
      <div class="row">
        <nav class="col-md-2 d-none d-md-block bg-light sidebar">
          <div class="sidebar-sticky">
            <ul class="nav flex-column">
              <li class="nav-item">
                <a class="nav-link active" href="#">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-home"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
                  Dashboard <span class="sr-only">(current)</span>
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="JavaScript:goToSales(event)">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-shopping-cart"><circle cx="9" cy="21" r="1"></circle><circle cx="20" cy="21" r="1"></circle><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path></svg>
                  Sales <span class="sr-only">(current)</span>
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link active" href="#">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-users"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
                  Expense
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-bar-chart-2"><line x1="18" y1="20" x2="18" y2="10"></line><line x1="12" y1="20" x2="12" y2="4"></line><line x1="6" y1="20" x2="6" y2="14"></line></svg>
                  Reports
                </a>
              </li>
            </ul>
          </div>
        </nav>

        <main role="main" class="col-md-9 ml-sm-auto col-lg-10 pt-3 px-4"><div class="chartjs-size-monitor" style="position: absolute; inset: 0px; overflow: hidden; pointer-events: none; visibility: hidden; z-index: -1;"><div class="chartjs-size-monitor-expand" style="position:absolute;left:0;top:0;right:0;bottom:0;overflow:hidden;pointer-events:none;visibility:hidden;z-index:-1;"><div style="position:absolute;width:1000000px;height:1000000px;left:0;top:0"></div></div><div class="chartjs-size-monitor-shrink" style="position:absolute;left:0;top:0;right:0;bottom:0;overflow:hidden;pointer-events:none;visibility:hidden;z-index:-1;"><div style="position:absolute;width:200%;height:200%;left:0; top:0"></div></div></div>
          <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pb-2 mb-3 border-bottom">
            <h1 class="h2">Dashboard</h1>
            <div class="btn-toolbar mb-2 mb-md-0">
              <div class="btn-group mr-2">
                <button class="btn btn-sm btn-outline-secondary">Share</button>
                <button class="btn btn-sm btn-outline-secondary">Export</button>
              </div>
              <button class="btn btn-sm btn-outline-secondary dropdown-toggle">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
                This week
              </button>
            </div>
          </div>

          <div class="row">
            <div class="col-sm-8"><h2>Daily Expense <b>Details</b></h2></div>            
            <div class="col-sm-4">
                <button type="button" class="btn btn-info add-new" id="myModal" data-toggle="modal" data-target="#addDailySalesModal"><i class="fa fa-plus"></i> Add New</button>
            </div>
          </div>
          <div class="table-responsive">
            <table id="daily_list_table" class="table table-striped table-bordered">
              <thead>
                <tr>
                  <th>#</th>
                  <th>Expense Date</th>
                  <th>Description</th>
                  <th>Credit(Rs.)</th>
                  <th>Benficiary</th>
                  <th>Account</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="daily_expense_list">
                <!-- <tr>
                  <td>1,001</td>
                  <td>Lorem</td>
                  <td>ipsum</td>
                  <td>dolor</td>
                  <td>sit</td>
                </tr> -->
              </tbody>
            </table>
          </div>
        </main>
      </div>
    </div>
    <div class="copyright p-3">
      <div class="container">
          <div class="row">
              <div class="col-md-12 justify-content-center text-center">
                  <span>Copyright &copy; 2021 DreamCoder Nepal, All Right Reserved</span>
              </div>
              <!-- End col -->
          </div>
          <!-- End Row -->
      </div>
      <!-- End Copyright Container -->
    </div>
    <div class="modal" tabindex="-1" role="dialog" id="addDailySalesModal">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Add - Daily Expense Record</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <div class="alert alert-danger" role="alert" style="display: none;">
              Please fill out details Correctly!
            </div>
            <form id="formDailyExpense" onSubmit="JavaScript:sendAddExpenseForm(event)">
              <div class="form-group">
                <label for="description-name" class="col-form-label">Description:</label>
                <input type="text" class="form-control" id="description-name" name="add_description" required>
              </div>
              <div class="form-group">
                <label for="credit-name" class="col-form-label">Credit(Rs.):</label>
                <input type="text" class="form-control" id="credit-name" name="add_credit" onkeypress="return isNumberKey(event)" required>
              </div>
              <div class="form-group">
                <label for="description-receiver" class="col-form-label">Benficiary(Credit to):</label>
                <input type="text" class="form-control" id="description-receiver" name="add_receiver" required>
              </div>
              <div class="form-group">
                <label for="account-name" class="col-form-label">Account</label>
                <Select class="form-control" name="add_account" id="account-name">
                  <option value="cash">Cash</option>
                  <option value="credit">Credit</option>
                </Select>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-primary" id="addExpense">Add Expense</button>
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>
    <!-- Optional JavaScript -->
    <script src="./src/js/jquery-3.3.1.min.js"></script>
    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="./src/js/jquery-3.3.1.slim.min.js"></script>
    <script src="./src/js/popper.min.js"></script>
    <script src="./src/js/bootstrap.min.js"></script>
    <script src="./src/js/jquery.dataTables.min.js"></script>
    

    <!-- Icons -->
    <script src="./src/js/feather.min.js"></script>
    <script>
      feather.replace()
    </script>
    <script>
      // mODAL to add daily sales record
      $('#myModal').on('shown.bs.modal', function () {
        $('#myInput').trigger('focus')
      });
    </script>
    <script src='./renderFile.js'></script>
    <script>
      window.onload = get_daily_expense;
      
      // Require ipcRenderer
      //const { ipcRenderer } = require('electron');
      ipcRenderer.on('action-error-insert-row', (event, arg) => {
          // Update the second interface or whatever you need to do
          alert('Something went wrong! Please Update Row AGAIN@@.');
          // arg contains the data sent from the first view
          console.log(arg);
      });
      ipcRenderer.on('action-success-insert', (event, arg) => {
          // Update the second interface or whatever you need to do
          alert('Row Update successful!!');
          // arg contains the data sent from the first view
          console.log(arg);
          get_daily_expense();
      });
      
      ipcRenderer.on('action-error-delete-row', (event, arg) => {
          // Update the second interface or whatever you need to do
          alert('Something went wrong! Please DELETE Row AGAIN@@.');
          // arg contains the data sent from the first view
          console.log(arg);
      });
      ipcRenderer.on('action-success-delete', (event, arg) => {
          // Update the second interface or whatever you need to do
          alert('Row Deleted successful!!');
          // arg contains the data sent from the first view
          console.log(arg);
          get_daily_expense();
      });

      ipcRenderer.on('action-error-update-row', (event, arg) => {
          // Update the second interface or whatever you need to do
          alert('Something went wrong! Please Update Row AGAIN@@.');
          // arg contains the data sent from the first view
          console.log(arg);
      });
      ipcRenderer.on('action-success-update', (event, arg) => {
          // Update the second interface or whatever you need to do
          alert('Row Update successful!!');
          // arg contains the data sent from the first view
          console.log(arg);
      });
      // When the action-update-label event is triggered (from the main process)
      // Do something in the view
      ipcRenderer.on('action-error-expense', (event, arg) => {
          // Update the second interface or whatever you need to do
          alert('Something went wrong! Please Refresh the Page.');
          // arg contains the data sent from the first view
          console.log(arg);
      });
      ipcRenderer.on('action-success-list-expense', (event, daily_expense_list) => {
          // Update the second interface or whatever you need to do
          //alert('Success');
          // daily_expense_list contains the data sent from the ipc
          let daily_expense_list_html = '';
          let serialNo = 1;
          for (let item of daily_expense_list) {
            daily_expense_list_html += "<tr>"+
                  "<td>" + serialNo +"</td>" + 
                  "<td>" + item.expense_date +"</td>" + 
                  "<td>" + item.expense_description +"</td>" +
                  "<td>" + item.expense_credit +"</td>" +
                  "<td>" + item.expense_receiver +"</td>" +
                  "<td>" + item.expense_account +"</td>" +
                  "<td><a class='add' title='Add' data-toggle='tooltip' data-expenseid='"+ item.expense_id  +"'><i class='material-icons'>&#xE03B;</i></a><a class='edit' title='Edit' data-toggle='tooltip'><i class='material-icons'>&#xE254;</i></a><a class='cancel' title='Cancel' data-toggle='tooltip'><i class='material-icons'>&#xe5c9;</i><a class='delete' title='Delete' data-toggle='tooltip' data-expenseid='"+ item.expense_id +"'><i class='material-icons'>&#xE872;</i></a></td>" +
                "</tr>"; 
                serialNo++;
          } 
          $(document).ready(function() {
            $('#daily_list_table').DataTable().destroy();
            $('#daily_expense_list').empty();
            $('#daily_expense_list').prepend(daily_expense_list_html);
            $('#daily_list_table').DataTable();
          });
      });
      
      let beforeEditData = {};
      let beforeUpdateData = {};
      // Edit row on edit button click
      $(document).on("click", ".edit", function(){
        // Only edit description, credit, profit, debited
        $(this).parents("tr").each(function( index ) {
          $(this).find("td:nth-child(3)").each(function(){
            beforeEditData["description"] = $(this).text();
            $(this).html('<input type="text" name="expense_description" id="expense_description" class="form-control" value="' + $(this).text() + '" data-id="description">');
          });
          $(this).find("td:nth-child(4)").each(function(){
            beforeEditData["credit"] = $(this).text();
            $(this).html('<input type="text" name="expense_credit" id="expense_credit" class="form-control" value="' + $(this).text() + '" data-id="credit" onkeypress="return isNumberKey(event)">');
          });
          $(this).find("td:nth-child(5)").each(function(){
            beforeEditData["receiver"] = $(this).text();
            $(this).html('<input type="text" name="expense_receiver" id="expense_receiver" class="form-control" value="' + $(this).text() + '" data-id="receiver">'); 
          });
          $(this).find("td:nth-child(6)").each(function(){
            beforeEditData["debited"] = $(this).text();
            let tempDropdownHtml = '<select name="expense_account" id="expense_account" class="form-control" data-id="debited">';
            if($(this).text()=="cash"){
              tempDropdownHtml += '<option value="cash" selected>Cash</option><option value="credit">Credit</option>';
            }else{
              tempDropdownHtml += '<option value="cash">Cash</option><option value="credit" selected>Credit</option>';
            }
            tempDropdownHtml += '</select>';
            $(this).html(tempDropdownHtml);
          });
          
        });		
        $(this).parents("tr").find(".add, .edit").toggle();
        $(this).parents("tr").find(".cancel, .delete").toggle();
        $(".add-new").attr("disabled", "disabled");
        $(".edit, .delete").not(this).hide();
      });
      // Add Edited row on add button click()
      $(document).on("click", ".add", function(){
        let data_id = $(this).data('expenseid');
        var empty = false;
        var input = $(this).parents("tr").find('input[type="text"]');
        var dropdowninput = $(this).parents("tr").find('select');
        input.each(function(){
          if(!$(this).val()){
            $(this).addClass("error");
            empty = true;
          } else{
            $(this).removeClass("error");
          }   
        }); 
        $(this).parents("tr").find(".error").first().focus();
        if(!empty){
          let expense_id = $(this).data( "expenseid" );
          let description = $(this).parents("tr").find('input[name="expense_description"]').val();
          let credit = $(this).parents("tr").find('input[name="expense_credit"]').val();
          let receiver = $(this).parents("tr").find('input[name="expense_receiver"]').val();
          let account = $(this).parents("tr").find('select[name="expense_account"]').val();
          let updateThisData = {expense_description:description,expense_credit:credit,expense_receiver:receiver,expense_account:account,expense_id:expense_id};
          // ToDO: get val by name, pass it to IPC, Update the redord in dbase
          update_expense_list_row(updateThisData);
          input.each(function(){
            $(this).parent("td").html($(this).val());
          });			
          $(this).parents("tr").find(".add, .edit").toggle();
          $(this).parents("tr").find(".cancel, .delete").toggle();
          $(".add-new").removeAttr("disabled");
          $(".edit, .delete").not(this).show();  
        }	
        dropdowninput.each(function(){
          $(this).parent("td").html($(this).val());
        });	
      });
      // cancel the edit
      $(document).on("click", ".cancel", function(){
        var input = $(this).parents("tr").find('input[type="text"]');
        var dropdowninput = $(this).parents("tr").find('select');
        input.each(function(){
          let data_id = $(this).data('id');
          $(this).parent("td").html(beforeEditData[data_id]);
        });
        dropdowninput.each(function(){
          $(this).parent("td").html(beforeEditData['debited']);
        });
        $(this).parents("tr").find(".add, .edit").toggle();
        $(this).parents("tr").find(".cancel, .delete").toggle();
        $(".add-new").removeAttr("disabled");
        $(".edit, .delete").not(this).show();
        beforeEditData = {};
      });
      // Delete row on delete button click
      $(document).on("click", ".delete", function(event){
        if (window.confirm("Do you really want to delete?")) {
          // ToDO: Delete record in DBase
          let data_id = $(this).data('expenseid');
          delete_expense_list_row({rowId:data_id});
          $(this).parents("tr").remove();
        }else{
          event.preventDefault();
        }
        $(".add-new").removeAttr("disabled");
        $(".edit, .delete").not(this).show();
      });
      function isNumberKey(evt){
        var charCode = (evt.which) ? evt.which : evt.keyCode;
        if (charCode != 46 && charCode > 31 
          && (charCode < 48 || charCode > 57))
            return false;

        return true;
      }
      $( "#addExpense" ).click(function() {
        let valid = true;
        var input = $("#formDailyExpense").find('input[type="text"]');
        var dropdowninput = $("#formDailyExpense").find('select');
        input.each(function(){
          if ($.trim($(this).val())==null || $.trim($(this).val())=="") {
            valid=false;
          }
        });
        dropdowninput.each(function(){
          if ($.trim($(this).val())==null || $.trim($(this).val())=="") {
            valid=false;
          }
        });
        if(valid){
          $('.alert-danger').hide();
          $( "#formDailyExpense" ).submit();
          // clean input field
          input.each(function(){
            $(this).val('');
          });
        }else{
          $('.alert-danger').show();
          return;
        }
        
      });
    </script>
    <style>
.table-title .add-new {
    float: right;
    height: 30px;
    font-weight: bold;
    font-size: 12px;
    text-shadow: none;
    min-width: 100px;
    border-radius: 50px;
    line-height: 13px;
}
.table-title .add-new i {
    margin-right: 4px;
}
table.table {
    table-layout: fixed;
}
table.table tr th, table.table tr td {
    border-color: #e9e9e9;
}
table.table th i {
    font-size: 13px;
    margin: 0 5px;
    cursor: pointer;
}
table.table th:last-child {
    width: 100px;
}
table.table td a {
    cursor: pointer;
    display: inline-block;
    margin: 0 5px;
    min-width: 24px;
}    
table.table td a.add {
    color: #27C46B;
}
table.table td a.edit {
    color: #FFC107;
}
table.table td a.delete {
    color: #E34724;
}
table.table td i {
    font-size: 19px;
}
table.table td a.add i, table.table td a.cancel i {
    font-size: 24px;
    margin-right: -1px;
    position: relative;
    top: 3px;
}     
table.table .form-control {
    height: 32px;
    line-height: 32px;
    box-shadow: none;
    border-radius: 2px;
}
table.table select.form-control {
    height: 35px;
}
table.table .form-control.error {
    border-color: #f50000;
}
table.table td .add, table.table td .cancel {
    display: none;
}

    </style>
  </body>
</html>